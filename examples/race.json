{
    "name": "HKJC Race Results Extractor",
    "pattern": "(?i)racing/information/chinese/Racing/LocalResults.aspx\\?RaceDate=[^&]+",
    "example_url": "https://racing.hkjc.com/racing/information/chinese/Racing/LocalResults.aspx?RaceDate=2024/10/09",
    "schemas": [
        {
            "name": "race_info",
            "entity_type": "race_info",
            "selector": "//div[contains(@class, 'race_tab')]",
            "type": "nested",
            "fields": [
                {
                    "name": "_id",
                    "type": "nested",
                    "fields": [
                        {
                            "name": "_id_1",
                            "from": "url",
                            "pattern": "(?i)RaceDate=([^&]+)"
                        },
                        {
                            "name": "_id_2",
                            "from": "element",
                            "selector": "//td[contains(text(), '第') and contains(text(), '場')]",
                            "pattern": "(?i)第 (\\d+) 場"
                        }
                    ]
                },
                {
                    "name": "_time",
                    "from": "url",
                    "pattern": "(?i)RaceDate=([^&]+)"
                },
                {
                    "name": "race_date_and_venue",
                    "selector": "//span[contains(@class, 'f_fs13')]/text()",
                    "type": "text"
                },
                {
                    "name": "race_no",
                    "selector": ".//td[contains(text(), '第') and contains(text(), '場')]",
                    "type": "text"
                },
                {
                    "name": "class_and_distance",
                    "selector": ".//td[contains(text(), '第') and contains(text(), '班')]",
                    "type": "text"
                },
                {
                    "name": "track_condition",
                    "selector": ".//td[contains(text(), '場地狀況')]/following-sibling::td[1]",
                    "type": "text"
                },
                {
                    "name": "track_type",
                    "selector": ".//td[contains(text(), '賽道')]/following-sibling::td[1]",
                    "type": "text"
                },
                {
                    "name": "prize",
                    "selector": ".//td[contains(text(), 'HK$')]",
                    "type": "text"
                },
                {
                    "name": "race_times",
                    "selector": ".//td[text()='時間 :']/following-sibling::td",
                    "type": "list",
                    "fields": [
                        {
                            "name": "time",
                            "selector": ".",
                            "type": "text"
                        }
                    ]
                },
                {
                    "name": "section_times",
                    "selector": ".//td[text()='分段時間 :']/following-sibling::td",
                    "type": "list",
                    "fields": [
                        {
                            "name": "time",
                            "selector": ".",
                            "type": "text"
                        }
                    ]
                },
                {
                    "name": "race_type",
                    "selector": ".//td[contains(text(), '賽道')]/preceding-sibling::td[1]",
                    "type": "text"
                }
            ]
        },
        {
            "name": "race_results",
            "entity_type": "race_result",
            "selector": "//div[@class='performance']//tbody/tr",
            "type": "list",
            "fields": [
                {
                    "name": "_id",
                    "type": "nested",
                    "fields": [
                        {
                            "name": "_id_1",
                            "from": "url",
                            "pattern": "(?i)RaceDate=([^&]+)"
                        },
                        {
                            "name": "_id_2",
                            "from": "element",
                            "selector": "//td[contains(text(), '第') and contains(text(), '場')]",
                            "pattern": "(?i)第 (\\d+) 場"
                        },
                        {
                            "name": "_id_3",
                            "from": "element",
                            "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'馬名')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'馬名')]]/a/@href",
                            "pattern": "(?i)HorseId=([^&]+)"
                        }
                    ]
                },
                {
                    "name": "_time",
                    "from": "url",
                    "pattern": "(?i)RaceDate=([^&]+)"
                },
                {
                    "name": "place",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'名次')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'名次')]]",
                    "type": "text"
                },
                {
                    "name": "horse_no",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'馬號')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'馬號')]]",
                    "type": "text"
                },
                {
                    "name": "horse_name",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'馬名')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'馬名')]]",
                    "type": "text"
                },
                {
                    "name": "horse_link",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'馬名')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'馬名')]]/a",
                    "type": "attribute",
                    "attribute": "href"
                },
                {
                    "name": "jockey_name",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'騎師')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'騎師')]]",
                    "type": "text"
                },
                {
                    "name": "jockey_link",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'騎師')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'騎師')]]/a",
                    "type": "attribute",
                    "attribute": "href"
                },
                {
                    "name": "trainer_name",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'練馬師')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'練馬師')]]",
                    "type": "text"
                },
                {
                    "name": "trainer_link",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'練馬師')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'練馬師')]]/a",
                    "type": "attribute",
                    "attribute": "href"
                },
                {
                    "name": "actual_weight",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'實際')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'實際')]]",
                    "type": "text"
                },
                {
                    "name": "horse_weight",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'排位')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'排位')]]",
                    "type": "text"
                },
                {
                    "name": "draw",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'檔位')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'檔位')]]",
                    "type": "text"
                },
                {
                    "name": "length_behind",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'頭馬')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'頭馬')]]",
                    "type": "text"
                },
                {
                    "name": "running_position",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'沿途')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'沿途')]]",
                    "type": "text"
                },
                {
                    "name": "finish_time",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'完成')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'完成')]]",
                    "type": "text"
                },
                {
                    "name": "win_odds",
                    "selector": ".//td[count(//div[@class='performance']//thead//td[contains(text(),'獨贏')]/preceding-sibling::td)+1][ancestor::table//td[contains(text(),'獨贏')]]",
                    "type": "text"
                }
            ]
        }
    ]
} 